{
  "name": "Workflow D - LINE Bot Commands",
  "nodes": [
    {
      "parameters": {
        "httpMethod": "POST",
        "path": "line-webhook",
        "responseMode": "lastNode",
        "options": {}
      },
      "id": "webhook-line",
      "name": "LINE Webhook",
      "type": "n8n-nodes-base.webhook",
      "typeVersion": 2,
      "position": [250, 300],
      "webhookId": "line-bot-webhook"
    },
    {
      "parameters": {
        "jsCode": "// è§£æ LINE Webhook äº‹ä»¶\nconst body = $input.first().json.body;\nconst defaultResponse = { status: 'ok' };\n\nif (!body || !body.events || body.events.length === 0) {\n  return [{ json: { ...defaultResponse, action: 'skip', reason: 'No events' } }];\n}\n\nconst event = body.events[0];\n\n// åªè™•ç†æ–‡å­—è¨Šæ¯\nif (event.type !== 'message' || event.message.type !== 'text') {\n  return [{ json: { ...defaultResponse, action: 'skip', reason: 'Not a text message' } }];\n}\n\nconst text = event.message.text.trim();\nconst userId = event.source.userId;\nconst replyToken = event.replyToken;\n\n// åˆ¤æ–·æ˜¯å¦ç‚ºæŒ‡ä»¤æˆ– YES ç¢ºèª\nconst isCommand = text.startsWith('/');\nconst isYesConfirm = text.toUpperCase() === 'YES';\n\nif (!isCommand && !isYesConfirm) {\n  return [{ json: { ...defaultResponse, action: 'skip', reason: 'Not a command' } }];\n}\n\n// è§£ææŒ‡ä»¤å’Œåƒæ•¸\nconst parts = text.split(/\\s+/);\nconst command = isCommand ? parts[0].toLowerCase() : 'yes-confirm';\nconst args = parts.slice(1);\n\n// ç®¡ç†è€…ç™½åå–®\nconst ADMIN_USER_IDS = ['U9db30529ea43839f12dfc20588d3a421'];\nconst isAdmin = ADMIN_USER_IDS.includes(userId);\n\n// éç®¡ç†è€…ä¸èƒ½ä½¿ç”¨ä»»ä½•æŒ‡ä»¤\nif (!isAdmin) {\n  return [{\n    json: {\n      ...defaultResponse,\n      action: 'process',\n      userId,\n      replyToken,\n      command,\n      args,\n      isAdmin,\n      rawText: text,\n      route: 'not-authorized'\n    }\n  }];\n}\n\n// è·¯ç”±æ±ºå®šï¼ˆåƒ…ç®¡ç†è€…ï¼‰\nlet route = 'unknown';\nif (command === '/my-status') route = 'my-status';\nelse if (command === '/clear-me') route = 'clear-me';\nelse if (command === '/help') route = 'help';\nelse if (command === 'yes-confirm') route = 'yes-confirm';\nelse if (command === '/list-usr') route = 'list-usr';\nelse if (command === '/check-usr') route = 'check-usr';\nelse if (command === '/del-usr') route = 'del-usr';\nelse if (command === '/clear-all') route = 'clear-all';\n\nreturn [{\n  json: {\n    ...defaultResponse,\n    action: 'process',\n    userId,\n    replyToken,\n    command,\n    args,\n    isAdmin,\n    rawText: text,\n    route\n  }\n}];"
      },
      "id": "code-parse-message",
      "name": "Parse Message",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [450, 300]
    },
    {
      "parameters": {
        "conditions": {
          "options": { "caseSensitive": true, "leftValue": "", "typeValidation": "strict" },
          "conditions": [
            { "id": "check-process", "leftValue": "={{ $json.action }}", "rightValue": "process", "operator": { "type": "string", "operation": "equals" } }
          ],
          "combinator": "and"
        }
      },
      "id": "if-should-process",
      "name": "Should Process?",
      "type": "n8n-nodes-base.if",
      "typeVersion": 2,
      "position": [650, 300]
    },
    {
      "parameters": {
        "rules": {
          "values": [
            { "conditions": { "options": { "caseSensitive": true, "leftValue": "", "typeValidation": "strict" }, "conditions": [{ "leftValue": "={{ $json.route }}", "rightValue": "not-authorized", "operator": { "type": "string", "operation": "equals" } }], "combinator": "and" }, "outputKey": "not-authorized" },
            { "conditions": { "options": { "caseSensitive": true, "leftValue": "", "typeValidation": "strict" }, "conditions": [{ "leftValue": "={{ $json.route }}", "rightValue": "my-status", "operator": { "type": "string", "operation": "equals" } }], "combinator": "and" }, "outputKey": "my-status" },
            { "conditions": { "options": { "caseSensitive": true, "leftValue": "", "typeValidation": "strict" }, "conditions": [{ "leftValue": "={{ $json.route }}", "rightValue": "help", "operator": { "type": "string", "operation": "equals" } }], "combinator": "and" }, "outputKey": "help" },
            { "conditions": { "options": { "caseSensitive": true, "leftValue": "", "typeValidation": "strict" }, "conditions": [{ "leftValue": "={{ $json.route }}", "rightValue": "clear-me", "operator": { "type": "string", "operation": "equals" } }], "combinator": "and" }, "outputKey": "clear-me" },
            { "conditions": { "options": { "caseSensitive": true, "leftValue": "", "typeValidation": "strict" }, "conditions": [{ "leftValue": "={{ $json.route }}", "rightValue": "yes-confirm", "operator": { "type": "string", "operation": "equals" } }], "combinator": "and" }, "outputKey": "yes-confirm" },
            { "conditions": { "options": { "caseSensitive": true, "leftValue": "", "typeValidation": "strict" }, "conditions": [{ "leftValue": "={{ $json.route }}", "rightValue": "list-usr", "operator": { "type": "string", "operation": "equals" } }], "combinator": "and" }, "outputKey": "list-usr" },
            { "conditions": { "options": { "caseSensitive": true, "leftValue": "", "typeValidation": "strict" }, "conditions": [{ "leftValue": "={{ $json.route }}", "rightValue": "check-usr", "operator": { "type": "string", "operation": "equals" } }], "combinator": "and" }, "outputKey": "check-usr" },
            { "conditions": { "options": { "caseSensitive": true, "leftValue": "", "typeValidation": "strict" }, "conditions": [{ "leftValue": "={{ $json.route }}", "rightValue": "del-usr", "operator": { "type": "string", "operation": "equals" } }], "combinator": "and" }, "outputKey": "del-usr" },
            { "conditions": { "options": { "caseSensitive": true, "leftValue": "", "typeValidation": "strict" }, "conditions": [{ "leftValue": "={{ $json.route }}", "rightValue": "clear-all", "operator": { "type": "string", "operation": "equals" } }], "combinator": "and" }, "outputKey": "clear-all" }
          ]
        },
        "options": { "fallbackOutput": "extra" }
      },
      "id": "switch-command",
      "name": "Command Router",
      "type": "n8n-nodes-base.switch",
      "typeVersion": 3,
      "position": [850, 300]
    },
    {
      "parameters": {
        "operation": "read",
        "documentId": { "__rl": true, "mode": "id", "value": "1Nn3tyYmGxioF6p_4i9vc6ABCn0NnsJu72FHC_Xlozxg" },
        "sheetName": { "__rl": true, "mode": "name", "value": "Master_Sync" },
        "filters": { "conditions": [{ "lookupColumn": "Line_UID", "lookupValue": "={{ $('Parse Message').item.json.userId }}" }] },
        "options": {}
      },
      "id": "sheets-get-my-status",
      "name": "Get My Status",
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.5,
      "position": [1100, 0],
      "credentials": { "googleSheetsOAuth2Api": { "id": "n8n-sheet-guard-master", "name": "n8n-sheet-guard-master" } },
      "alwaysOutputData": true
    },
    {
      "parameters": {
        "jsCode": "// /my-status å›è¦†\nconst data = $input.all();\nconst parsed = $('Parse Message').first().json;\n\nlet message = '';\nif (data.length === 0 || !data[0].json.Line_UID) {\n  message = 'âŒ ä½ å°šæœªè¨»å†Šã€‚\\nè«‹å‰å¾€è¨­å®šé é¢å®Œæˆè¨»å†Šã€‚';\n} else {\n  const user = data[0].json;\n  const realName = user.Real_Name || 'ï¼ˆæœªè¨­å®šï¼‰';\n  const aliases = user.Aliases || 'ï¼ˆç„¡ï¼‰';\n  \n  let sheets = 'ï¼ˆç„¡ï¼‰';\n  try {\n    if (user.Sheet_Urls_JSON) {\n      const sheetList = JSON.parse(user.Sheet_Urls_JSON);\n      if (sheetList.length > 0) {\n        sheets = sheetList.map(s => 'â€¢ ' + s.name).join('\\n');\n      }\n    }\n  } catch (e) {}\n  \n  message = 'ğŸ“‹ ä½ çš„è¨»å†Šè³‡æ–™\\n\\nå§“åï¼š' + realName + '\\nåˆ¥åï¼š' + aliases + '\\n\\né—œæ³¨å ±è¡¨ï¼š\\n' + sheets;\n}\n\nreturn [{ json: { replyToken: parsed.replyToken, message } }];"
      },
      "id": "code-format-my-status",
      "name": "Format My Status",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [1300, 0]
    },
    {
      "parameters": {
        "jsCode": "// /help å›è¦†ï¼ˆåƒ…ç®¡ç†è€…å¯ç”¨ï¼‰\nconst parsed = $('Parse Message').first().json;\n\nlet message = 'ğŸ‘‘ ç®¡ç†è€…æŒ‡ä»¤ï¼š\\n\\n';\nmessage += '/my-status - æŸ¥çœ‹ä½ çš„è¨»å†Šè³‡æ–™\\n';\nmessage += '/clear-me - æ¸…ç©ºä½ çš„è¨»å†Šè³‡æ–™\\n';\nmessage += '/help - é¡¯ç¤ºæ­¤èªªæ˜\\n';\nmessage += '/list-usr - åˆ—å‡ºæ‰€æœ‰ä½¿ç”¨è€…\\n';\nmessage += '/check-usr {userId} - æŸ¥çœ‹ç‰¹å®šä½¿ç”¨è€…è©³æƒ…\\n';\nmessage += '/del-usr {userId} - åˆªé™¤æŒ‡å®šä½¿ç”¨è€…\\n';\nmessage += '/clear-all - æ¸…ç©ºæ‰€æœ‰è³‡æ–™';\n\nreturn [{ json: { replyToken: parsed.replyToken, message } }];"
      },
      "id": "code-help",
      "name": "Format Help",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [1100, 100]
    },
    {
      "parameters": {
        "operation": "appendOrUpdate",
        "documentId": { "__rl": true, "mode": "id", "value": "1Nn3tyYmGxioF6p_4i9vc6ABCn0NnsJu72FHC_Xlozxg" },
        "sheetName": { "__rl": true, "mode": "name", "value": "Pending_Confirmations" },
        "columns": {
          "mappingMode": "defineBelow",
          "schema": [
            { "id": "User_ID", "displayName": "User_ID", "required": false, "defaultMatch": true, "canBeUsedToMatch": true, "type": "string" },
            { "id": "Action", "displayName": "Action", "required": false, "defaultMatch": false, "canBeUsedToMatch": false, "type": "string" },
            { "id": "Timestamp", "displayName": "Timestamp", "required": false, "defaultMatch": false, "canBeUsedToMatch": false, "type": "string" }
          ],
          "value": {
            "User_ID": "={{ $('Parse Message').item.json.userId }}",
            "Action": "clear-me",
            "Timestamp": "={{ Date.now() }}"
          },
          "matchingColumns": ["User_ID"]
        },
        "options": { "cellFormat": "USER_ENTERED" }
      },
      "id": "sheets-save-pending-clear-me",
      "name": "Save Pending (clear-me)",
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.5,
      "position": [1100, 200],
      "credentials": { "googleSheetsOAuth2Api": { "id": "n8n-sheet-guard-master", "name": "n8n-sheet-guard-master" } }
    },
    {
      "parameters": {
        "jsCode": "// /clear-me - å›è¦†ç¢ºèªè¨Šæ¯\nconst parsed = $('Parse Message').first().json;\n\nconst message = 'âš ï¸ ç¢ºå®šè¦æ¸…ç©ºä½ çš„æ‰€æœ‰è¨»å†Šè³‡æ–™å—ï¼Ÿ\\n\\né€™æœƒåˆªé™¤ï¼š\\nâ€¢ çœŸå¯¦å§“å\\nâ€¢ æ‰€æœ‰åˆ¥å\\nâ€¢ æ‰€æœ‰é—œæ³¨å ±è¡¨\\n\\nè«‹åœ¨ 5 åˆ†é˜å…§å›è¦† YES ç¢ºèª';\n\nreturn [{ json: { replyToken: parsed.replyToken, message } }];"
      },
      "id": "code-clear-me-ask",
      "name": "Clear Me - Ask Confirm",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [1300, 200]
    },
    {
      "parameters": {
        "operation": "read",
        "documentId": { "__rl": true, "mode": "id", "value": "1Nn3tyYmGxioF6p_4i9vc6ABCn0NnsJu72FHC_Xlozxg" },
        "sheetName": { "__rl": true, "mode": "name", "value": "Pending_Confirmations" },
        "filters": { "conditions": [{ "lookupColumn": "User_ID", "lookupValue": "={{ $('Parse Message').item.json.userId }}" }] },
        "options": {}
      },
      "id": "sheets-get-pending",
      "name": "Get Pending Confirmation",
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.5,
      "position": [1100, 300],
      "credentials": { "googleSheetsOAuth2Api": { "id": "n8n-sheet-guard-master", "name": "n8n-sheet-guard-master" } },
      "alwaysOutputData": true
    },
    {
      "parameters": {
        "jsCode": "// YES ç¢ºèªè™•ç† - æª¢æŸ¥å¾…ç¢ºèªç‹€æ…‹\nconst data = $input.all();\nconst parsed = $('Parse Message').first().json;\n\n// æ²’æœ‰å¾…ç¢ºèªè¨˜éŒ„\nif (data.length === 0 || !data[0].json.User_ID) {\n  return [{ json: { \n    replyToken: parsed.replyToken, \n    message: 'â“ æ²’æœ‰å¾…ç¢ºèªçš„æ“ä½œã€‚\\n\\nå¦‚è¦æ¸…ç©ºè³‡æ–™ï¼Œè«‹å…ˆè¼¸å…¥ /clear-me',\n    action: 'none'\n  } }];\n}\n\nconst pending = data[0].json;\nconst timestamp = parseInt(pending.Timestamp);\nconst now = Date.now();\nconst fiveMinutes = 5 * 60 * 1000;\n\n// æª¢æŸ¥æ˜¯å¦éæœŸï¼ˆ5åˆ†é˜ï¼‰\nif (now - timestamp > fiveMinutes) {\n  return [{ json: { \n    replyToken: parsed.replyToken, \n    message: 'â° ç¢ºèªå·²éæœŸï¼ˆè¶…é 5 åˆ†é˜ï¼‰ã€‚\\n\\nè«‹é‡æ–°è¼¸å…¥æŒ‡ä»¤ã€‚',\n    action: 'expired',\n    pendingUserId: pending.User_ID\n  } }];\n}\n\n// æœ‰æ•ˆçš„å¾…ç¢ºèªæ“ä½œ\nreturn [{ json: { \n  replyToken: parsed.replyToken,\n  action: pending.Action,\n  pendingUserId: pending.User_ID,\n  userId: parsed.userId\n} }];"
      },
      "id": "code-check-pending",
      "name": "Check Pending Status",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [1300, 300]
    },
    {
      "parameters": {
        "rules": {
          "values": [
            { "conditions": { "options": { "caseSensitive": true, "leftValue": "", "typeValidation": "strict" }, "conditions": [{ "leftValue": "={{ $json.action }}", "rightValue": "clear-me", "operator": { "type": "string", "operation": "equals" } }], "combinator": "and" }, "outputKey": "clear-me" },
            { "conditions": { "options": { "caseSensitive": true, "leftValue": "", "typeValidation": "strict" }, "conditions": [{ "leftValue": "={{ $json.action }}", "rightValue": "clear-all", "operator": { "type": "string", "operation": "equals" } }], "combinator": "and" }, "outputKey": "clear-all" }
          ]
        },
        "options": { "fallbackOutput": "extra" }
      },
      "id": "switch-pending-action",
      "name": "Route Pending Action",
      "type": "n8n-nodes-base.switch",
      "typeVersion": 3,
      "position": [1500, 300]
    },
    {
      "parameters": {
        "operation": "delete",
        "documentId": { "__rl": true, "mode": "id", "value": "1Nn3tyYmGxioF6p_4i9vc6ABCn0NnsJu72FHC_Xlozxg" },
        "sheetName": { "__rl": true, "mode": "name", "value": "Master_Sync" },
        "filters": { "conditions": [{ "lookupColumn": "Line_UID", "lookupValue": "={{ $('Check Pending Status').item.json.userId }}" }] },
        "options": {}
      },
      "id": "sheets-exec-clear-me",
      "name": "Execute Clear Me",
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.5,
      "position": [1700, 200],
      "credentials": { "googleSheetsOAuth2Api": { "id": "n8n-sheet-guard-master", "name": "n8n-sheet-guard-master" } },
      "alwaysOutputData": true
    },
    {
      "parameters": {
        "operation": "delete",
        "documentId": { "__rl": true, "mode": "id", "value": "1Nn3tyYmGxioF6p_4i9vc6ABCn0NnsJu72FHC_Xlozxg" },
        "sheetName": { "__rl": true, "mode": "name", "value": "Pending_Confirmations" },
        "filters": { "conditions": [{ "lookupColumn": "User_ID", "lookupValue": "={{ $('Check Pending Status').item.json.userId }}" }] },
        "options": {}
      },
      "id": "sheets-delete-pending-clear-me",
      "name": "Delete Pending (clear-me)",
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.5,
      "position": [1900, 200],
      "credentials": { "googleSheetsOAuth2Api": { "id": "n8n-sheet-guard-master", "name": "n8n-sheet-guard-master" } },
      "alwaysOutputData": true
    },
    {
      "parameters": {
        "jsCode": "// clear-me åŸ·è¡Œå®Œæˆå›è¦†\nconst replyToken = $('Check Pending Status').first().json.replyToken;\nconst message = 'âœ… å·²æ¸…ç©ºä½ çš„æ‰€æœ‰è¨»å†Šè³‡æ–™ã€‚';\n\nreturn [{ json: { replyToken, message } }];"
      },
      "id": "code-clear-me-done",
      "name": "Clear Me Done",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [2100, 200]
    },
    {
      "parameters": {
        "method": "GET",
        "url": "https://sheets.googleapis.com/v4/spreadsheets/1Nn3tyYmGxioF6p_4i9vc6ABCn0NnsJu72FHC_Xlozxg",
        "authentication": "predefinedCredentialType",
        "nodeCredentialType": "googleSheetsOAuth2Api",
        "sendQuery": true,
        "queryParameters": { "parameters": [{ "name": "fields", "value": "sheets.properties" }] },
        "options": {}
      },
      "id": "http-get-sheet-info",
      "name": "Get Sheet Info",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [1700, 350],
      "credentials": { "googleSheetsOAuth2Api": { "id": "n8n-sheet-guard-master", "name": "n8n-sheet-guard-master" } }
    },
    {
      "parameters": {
        "jsCode": "// æº–å‚™ clear-all åˆªé™¤è«‹æ±‚\n// æ‰¾åˆ° Master_Sync sheet çš„ sheetId\nconst sheetInfo = $input.first().json;\nconst masterSheet = sheetInfo.sheets.find(s => s.properties.title === 'Master_Sync');\n\nif (!masterSheet) {\n  throw new Error('æ‰¾ä¸åˆ° Master_Sync å·¥ä½œè¡¨');\n}\n\nconst sheetId = masterSheet.properties.sheetId;\nconst rowCount = masterSheet.properties.gridProperties.rowCount;\n\n// å–å¾— replyToken å’Œ userId\nconst replyToken = $('Check Pending Status').first().json.replyToken;\nconst userId = $('Check Pending Status').first().json.userId;\n\n// å¦‚æœåªæœ‰ header row (rowCount <= 1)ï¼Œå‰‡æ²’æœ‰è³‡æ–™å¯åˆª\nif (rowCount <= 1) {\n  return [{ json: { \n    replyToken, \n    message: 'ğŸ“­ æ²’æœ‰éœ€è¦æ¸…ç©ºçš„è³‡æ–™ã€‚',\n    skipDelete: true,\n    deletedCount: 0\n  } }];\n}\n\n// å»ºç«‹åˆªé™¤è«‹æ±‚ï¼šåˆªé™¤å¾ row 2 åˆ°æœ€å¾Œä¸€è¡Œï¼ˆ0-indexed: startIndex=1ï¼‰\nconst deleteRequest = {\n  requests: [{\n    deleteDimension: {\n      range: {\n        sheetId: sheetId,\n        dimension: 'ROWS',\n        startIndex: 1,  // 0-indexed, æ‰€ä»¥ 1 = row 2\n        endIndex: rowCount  // åˆªé™¤åˆ°æœ€å¾Œ\n      }\n    }\n  }]\n};\n\nreturn [{ json: { \n  replyToken,\n  userId,\n  deleteRequest,\n  skipDelete: false,\n  deletedCount: rowCount - 1  // ä¸åŒ…å« header\n} }];"
      },
      "id": "code-prepare-clear-all",
      "name": "Prepare Clear All",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [1900, 350]
    },
    {
      "parameters": {
        "conditions": {
          "options": { "caseSensitive": true, "leftValue": "", "typeValidation": "strict" },
          "conditions": [{ "id": "skip", "leftValue": "={{ $json.skipDelete }}", "rightValue": true, "operator": { "type": "boolean", "operation": "notEquals" } }],
          "combinator": "and"
        }
      },
      "id": "if-should-delete-all",
      "name": "Should Delete?",
      "type": "n8n-nodes-base.if",
      "typeVersion": 2,
      "position": [2100, 350]
    },
    {
      "parameters": {
        "method": "POST",
        "url": "https://sheets.googleapis.com/v4/spreadsheets/1Nn3tyYmGxioF6p_4i9vc6ABCn0NnsJu72FHC_Xlozxg:batchUpdate",
        "authentication": "predefinedCredentialType",
        "nodeCredentialType": "googleSheetsOAuth2Api",
        "sendBody": true,
        "specifyBody": "json",
        "jsonBody": "={{ JSON.stringify($json.deleteRequest) }}",
        "options": {}
      },
      "id": "http-delete-all-rows",
      "name": "Delete All Rows",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [2300, 300],
      "credentials": { "googleSheetsOAuth2Api": { "id": "n8n-sheet-guard-master", "name": "n8n-sheet-guard-master" } }
    },
    {
      "parameters": {
        "operation": "delete",
        "documentId": { "__rl": true, "mode": "id", "value": "1Nn3tyYmGxioF6p_4i9vc6ABCn0NnsJu72FHC_Xlozxg" },
        "sheetName": { "__rl": true, "mode": "name", "value": "Pending_Confirmations" },
        "filters": { "conditions": [{ "lookupColumn": "User_ID", "lookupValue": "={{ $('Prepare Clear All').first().json.userId }}" }] },
        "options": {}
      },
      "id": "sheets-delete-pending-clear-all",
      "name": "Delete Pending (clear-all)",
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.5,
      "position": [2500, 300],
      "credentials": { "googleSheetsOAuth2Api": { "id": "n8n-sheet-guard-master", "name": "n8n-sheet-guard-master" } },
      "alwaysOutputData": true
    },
    {
      "parameters": {
        "jsCode": "// clear-all åŸ·è¡Œå®Œæˆå›è¦†\nconst replyToken = $('Prepare Clear All').first().json.replyToken;\nconst count = $('Prepare Clear All').first().json.deletedCount || 0;\n\nconst message = 'âœ… å·²æ¸…ç©ºæ‰€æœ‰ä½¿ç”¨è€…è³‡æ–™ã€‚\\n\\nå…±åˆªé™¤ ' + count + ' åˆ—è¨˜éŒ„ã€‚';\n\nreturn [{ json: { replyToken, message } }];"
      },
      "id": "code-clear-all-done",
      "name": "Clear All Done",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [2700, 300]
    },
    {
      "parameters": {
        "jsCode": "// /list-usr - æª¢æŸ¥ç®¡ç†è€…æ¬Šé™\nconst parsed = $('Parse Message').first().json;\n\nif (!parsed.isAdmin) {\n  return [{ json: { replyToken: parsed.replyToken, message: 'â›” ä½ æ²’æœ‰æ¬Šé™åŸ·è¡Œæ­¤æ“ä½œ', authorized: false } }];\n}\n\nreturn [{ json: { authorized: true, replyToken: parsed.replyToken, userId: parsed.userId } }];"
      },
      "id": "code-check-admin-list",
      "name": "Check Admin (list-usr)",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [1100, 500]
    },
    {
      "parameters": {
        "conditions": {
          "options": { "caseSensitive": true, "leftValue": "", "typeValidation": "strict" },
          "conditions": [{ "id": "auth", "leftValue": "={{ $json.authorized }}", "rightValue": true, "operator": { "type": "boolean", "operation": "equals" } }],
          "combinator": "and"
        }
      },
      "id": "if-admin-list-auth",
      "name": "Admin Auth? (list)",
      "type": "n8n-nodes-base.if",
      "typeVersion": 2,
      "position": [1300, 500]
    },
    {
      "parameters": {
        "operation": "read",
        "documentId": { "__rl": true, "mode": "id", "value": "1Nn3tyYmGxioF6p_4i9vc6ABCn0NnsJu72FHC_Xlozxg" },
        "sheetName": { "__rl": true, "mode": "name", "value": "Master_Sync" },
        "options": {}
      },
      "id": "sheets-get-all-users",
      "name": "Get All Users (list)",
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.5,
      "position": [1500, 450],
      "credentials": { "googleSheetsOAuth2Api": { "id": "n8n-sheet-guard-master", "name": "n8n-sheet-guard-master" } },
      "alwaysOutputData": true
    },
    {
      "parameters": {
        "jsCode": "// /list-usr æ ¼å¼åŒ–\n// åš´æ ¼éæ¿¾ï¼šLine_UID å¿…é ˆå­˜åœ¨ä¸”ä¸ç‚ºç©º\nconst users = $input.all().filter(item => {\n  const uid = item.json.Line_UID;\n  return uid && typeof uid === 'string' && uid.trim().length > 0;\n});\nconst replyToken = $('Check Admin (list-usr)').first().json.replyToken;\n\nif (users.length === 0) {\n  return [{ json: { replyToken, message: 'ğŸ‘¥ ç›®å‰æ²’æœ‰å·²è¨»å†Šçš„ä½¿ç”¨è€…' } }];\n}\n\nlet list = users.map((item, idx) => {\n  const u = item.json;\n  const name = u.Real_Name || 'ï¼ˆæœªå‘½åï¼‰';\n  const uid = u.Line_UID.substring(0, 10) + '...';\n  let sheetCount = 0;\n  try {\n    if (u.Sheet_Urls_JSON) {\n      sheetCount = JSON.parse(u.Sheet_Urls_JSON).length;\n    }\n  } catch (e) {}\n  return (idx + 1) + '. ' + name + ' (' + uid + ') - ' + sheetCount + ' å€‹å ±è¡¨';\n}).join('\\n');\n\nconst message = 'ğŸ‘¥ å·²è¨»å†Šä½¿ç”¨è€…ï¼ˆå…± ' + users.length + ' äººï¼‰\\n\\n' + list;\n\nreturn [{ json: { replyToken, message } }];"
      },
      "id": "code-format-list-usr",
      "name": "Format list-usr",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [1700, 450]
    },
    {
      "parameters": {
        "jsCode": "// /check-usr - æª¢æŸ¥ç®¡ç†è€…æ¬Šé™å’Œåƒæ•¸\nconst parsed = $('Parse Message').first().json;\n\nif (!parsed.isAdmin) {\n  return [{ json: { replyToken: parsed.replyToken, message: 'â›” ä½ æ²’æœ‰æ¬Šé™åŸ·è¡Œæ­¤æ“ä½œ', authorized: false } }];\n}\n\nif (!parsed.args || parsed.args.length === 0) {\n  return [{ json: { replyToken: parsed.replyToken, message: 'âŒ è«‹æä¾›ä½¿ç”¨è€… ID\\n\\næ ¼å¼ï¼š/check-usr {userId}', authorized: false } }];\n}\n\nconst targetUserId = parsed.args[0];\n\nreturn [{ json: { authorized: true, replyToken: parsed.replyToken, targetUserId } }];"
      },
      "id": "code-check-admin-check-usr",
      "name": "Check Admin (check-usr)",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [1100, 600]
    },
    {
      "parameters": {
        "conditions": {
          "options": { "caseSensitive": true, "leftValue": "", "typeValidation": "strict" },
          "conditions": [{ "id": "auth", "leftValue": "={{ $json.authorized }}", "rightValue": true, "operator": { "type": "boolean", "operation": "equals" } }],
          "combinator": "and"
        }
      },
      "id": "if-admin-check-usr-auth",
      "name": "Admin Auth? (check)",
      "type": "n8n-nodes-base.if",
      "typeVersion": 2,
      "position": [1300, 600]
    },
    {
      "parameters": {
        "operation": "read",
        "documentId": { "__rl": true, "mode": "id", "value": "1Nn3tyYmGxioF6p_4i9vc6ABCn0NnsJu72FHC_Xlozxg" },
        "sheetName": { "__rl": true, "mode": "name", "value": "Master_Sync" },
        "filters": { "conditions": [{ "lookupColumn": "Line_UID", "lookupValue": "={{ $('Check Admin (check-usr)').item.json.targetUserId }}" }] },
        "options": {}
      },
      "id": "sheets-get-target-user",
      "name": "Get Target User (check)",
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.5,
      "position": [1500, 550],
      "credentials": { "googleSheetsOAuth2Api": { "id": "n8n-sheet-guard-master", "name": "n8n-sheet-guard-master" } },
      "alwaysOutputData": true
    },
    {
      "parameters": {
        "jsCode": "// /check-usr æ ¼å¼åŒ–è©³æƒ…\nconst data = $input.all();\nconst replyToken = $('Check Admin (check-usr)').first().json.replyToken;\nconst targetUserId = $('Check Admin (check-usr)').first().json.targetUserId;\n\nif (data.length === 0 || !data[0].json.Line_UID) {\n  return [{ json: { replyToken, message: 'âŒ æ‰¾ä¸åˆ°ä½¿ç”¨è€…ï¼š' + targetUserId } }];\n}\n\nconst user = data[0].json;\nconst realName = user.Real_Name || 'ï¼ˆæœªè¨­å®šï¼‰';\nconst aliases = user.Aliases || 'ï¼ˆç„¡ï¼‰';\nconst createdAt = user.Created_At || 'ï¼ˆæœªçŸ¥ï¼‰';\nconst updatedAt = user.Updated_At || 'ï¼ˆæœªçŸ¥ï¼‰';\n\nlet sheets = 'ï¼ˆç„¡ï¼‰';\ntry {\n  if (user.Sheet_Urls_JSON) {\n    const sheetList = JSON.parse(user.Sheet_Urls_JSON);\n    if (sheetList.length > 0) {\n      sheets = sheetList.map(s => 'â€¢ ' + s.name).join('\\n');\n    }\n  }\n} catch (e) {}\n\nlet message = 'ğŸ“‹ ä½¿ç”¨è€…è©³æƒ…\\n\\n';\nmessage += 'å§“åï¼š' + realName + '\\n';\nmessage += 'åˆ¥åï¼š' + aliases + '\\n\\n';\nmessage += 'é—œæ³¨å ±è¡¨ï¼š\\n' + sheets + '\\n\\n';\nmessage += 'è¨»å†Šæ™‚é–“ï¼š' + createdAt + '\\n';\nmessage += 'æœ€å¾Œæ›´æ–°ï¼š' + updatedAt + '\\n\\n';\nmessage += 'User IDï¼š\\n' + user.Line_UID;\n\nreturn [{ json: { replyToken, message } }];"
      },
      "id": "code-format-check-usr",
      "name": "Format check-usr",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [1700, 550]
    },
    {
      "parameters": {
        "jsCode": "// /del-usr - æª¢æŸ¥ç®¡ç†è€…æ¬Šé™å’Œåƒæ•¸\nconst parsed = $('Parse Message').first().json;\n\nif (!parsed.isAdmin) {\n  return [{ json: { replyToken: parsed.replyToken, message: 'â›” ä½ æ²’æœ‰æ¬Šé™åŸ·è¡Œæ­¤æ“ä½œ', authorized: false } }];\n}\n\nif (!parsed.args || parsed.args.length === 0) {\n  return [{ json: { replyToken: parsed.replyToken, message: 'âŒ è«‹æä¾›ä½¿ç”¨è€… ID\\n\\næ ¼å¼ï¼š/del-usr {userId}', authorized: false } }];\n}\n\nconst targetUserId = parsed.args[0];\n\nreturn [{ json: { authorized: true, replyToken: parsed.replyToken, targetUserId } }];"
      },
      "id": "code-check-admin-del-usr",
      "name": "Check Admin (del-usr)",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [1100, 700]
    },
    {
      "parameters": {
        "conditions": {
          "options": { "caseSensitive": true, "leftValue": "", "typeValidation": "strict" },
          "conditions": [{ "id": "auth", "leftValue": "={{ $json.authorized }}", "rightValue": true, "operator": { "type": "boolean", "operation": "equals" } }],
          "combinator": "and"
        }
      },
      "id": "if-admin-del-usr-auth",
      "name": "Admin Auth? (del)",
      "type": "n8n-nodes-base.if",
      "typeVersion": 2,
      "position": [1300, 700]
    },
    {
      "parameters": {
        "operation": "read",
        "documentId": { "__rl": true, "mode": "id", "value": "1Nn3tyYmGxioF6p_4i9vc6ABCn0NnsJu72FHC_Xlozxg" },
        "sheetName": { "__rl": true, "mode": "name", "value": "Master_Sync" },
        "options": {}
      },
      "id": "sheets-read-for-delete",
      "name": "Read All Users (del)",
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.5,
      "position": [1500, 650],
      "credentials": { "googleSheetsOAuth2Api": { "id": "n8n-sheet-guard-master", "name": "n8n-sheet-guard-master" } },
      "alwaysOutputData": true
    },
    {
      "parameters": {
        "jsCode": "// æ‰¾åˆ°ç›®æ¨™ç”¨æˆ¶ä¸¦å–å¾—å…¶ row_number\nconst allUsers = $input.all();\nconst targetUserId = $('Check Admin (del-usr)').first().json.targetUserId;\nconst replyToken = $('Check Admin (del-usr)').first().json.replyToken;\n\n// æ‰¾åˆ°åŒ¹é…çš„ç”¨æˆ¶\nconst targetUser = allUsers.find(item => item.json.Line_UID === targetUserId);\n\nif (!targetUser) {\n  return [{ json: { \n    replyToken, \n    message: 'âŒ æ‰¾ä¸åˆ°ä½¿ç”¨è€…ï¼š' + targetUserId,\n    userFound: false\n  } }];\n}\n\n// å–å¾— row_numberï¼ˆn8n Google Sheets read æœƒåŒ…å«é€™å€‹ï¼‰\nconst rowNumber = targetUser.json.row_number;\n\nif (!rowNumber) {\n  return [{ json: { \n    replyToken, \n    message: 'âŒ ç„¡æ³•å–å¾—ä½¿ç”¨è€…çš„åˆ—è™Ÿ',\n    userFound: false\n  } }];\n}\n\nreturn [{ json: { \n  replyToken,\n  targetUserId,\n  rowNumber,\n  userFound: true\n} }];"
      },
      "id": "code-find-user-for-delete",
      "name": "Find User Row",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [1700, 650]
    },
    {
      "parameters": {
        "conditions": {
          "options": { "caseSensitive": true, "leftValue": "", "typeValidation": "strict" },
          "conditions": [{ "id": "found", "leftValue": "={{ $json.userFound }}", "rightValue": true, "operator": { "type": "boolean", "operation": "equals" } }],
          "combinator": "and"
        }
      },
      "id": "if-user-found",
      "name": "User Found?",
      "type": "n8n-nodes-base.if",
      "typeVersion": 2,
      "position": [1900, 650]
    },
    {
      "parameters": {
        "method": "GET",
        "url": "https://sheets.googleapis.com/v4/spreadsheets/1Nn3tyYmGxioF6p_4i9vc6ABCn0NnsJu72FHC_Xlozxg",
        "authentication": "predefinedCredentialType",
        "nodeCredentialType": "googleSheetsOAuth2Api",
        "sendQuery": true,
        "queryParameters": { "parameters": [{ "name": "fields", "value": "sheets.properties" }] },
        "options": {}
      },
      "id": "http-get-sheet-info-del",
      "name": "Get Sheet Info (del)",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [2100, 600],
      "credentials": { "googleSheetsOAuth2Api": { "id": "n8n-sheet-guard-master", "name": "n8n-sheet-guard-master" } }
    },
    {
      "parameters": {
        "jsCode": "// æº–å‚™åˆªé™¤å–®ä¸€ç”¨æˆ¶çš„è«‹æ±‚\nconst sheetInfo = $input.first().json;\nconst masterSheet = sheetInfo.sheets.find(s => s.properties.title === 'Master_Sync');\n\nif (!masterSheet) {\n  throw new Error('æ‰¾ä¸åˆ° Master_Sync å·¥ä½œè¡¨');\n}\n\nconst sheetId = masterSheet.properties.sheetId;\nconst rowNumber = $('Find User Row').first().json.rowNumber;\nconst replyToken = $('Find User Row').first().json.replyToken;\nconst targetUserId = $('Find User Row').first().json.targetUserId;\n\n// å»ºç«‹åˆªé™¤è«‹æ±‚ï¼šåˆªé™¤æŒ‡å®šè¡Œï¼ˆrow_number æ˜¯ 1-indexedï¼ŒAPI æ˜¯ 0-indexedï¼‰\nconst deleteRequest = {\n  requests: [{\n    deleteDimension: {\n      range: {\n        sheetId: sheetId,\n        dimension: 'ROWS',\n        startIndex: rowNumber - 1,  // è½‰æ›ç‚º 0-indexed\n        endIndex: rowNumber  // exclusive\n      }\n    }\n  }]\n};\n\nreturn [{ json: { \n  replyToken,\n  targetUserId,\n  deleteRequest\n} }];"
      },
      "id": "code-prepare-delete-user",
      "name": "Prepare Delete User",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [2300, 600]
    },
    {
      "parameters": {
        "method": "POST",
        "url": "https://sheets.googleapis.com/v4/spreadsheets/1Nn3tyYmGxioF6p_4i9vc6ABCn0NnsJu72FHC_Xlozxg:batchUpdate",
        "authentication": "predefinedCredentialType",
        "nodeCredentialType": "googleSheetsOAuth2Api",
        "sendBody": true,
        "specifyBody": "json",
        "jsonBody": "={{ JSON.stringify($json.deleteRequest) }}",
        "options": {}
      },
      "id": "http-delete-user-row",
      "name": "Delete User Row",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [2500, 600],
      "credentials": { "googleSheetsOAuth2Api": { "id": "n8n-sheet-guard-master", "name": "n8n-sheet-guard-master" } }
    },
    {
      "parameters": {
        "jsCode": "// /del-usr æˆåŠŸå›è¦†\nconst replyToken = $('Prepare Delete User').first().json.replyToken;\nconst targetUserId = $('Prepare Delete User').first().json.targetUserId;\n\nconst message = 'âœ… å·²åˆªé™¤ä½¿ç”¨è€…ï¼š' + targetUserId.substring(0, 10) + '...';\n\nreturn [{ json: { replyToken, message } }];"
      },
      "id": "code-format-del-usr-success",
      "name": "Format del-usr (success)",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [2700, 600]
    },
    {
      "parameters": {
        "operation": "appendOrUpdate",
        "documentId": { "__rl": true, "mode": "id", "value": "1Nn3tyYmGxioF6p_4i9vc6ABCn0NnsJu72FHC_Xlozxg" },
        "sheetName": { "__rl": true, "mode": "name", "value": "Pending_Confirmations" },
        "columns": {
          "mappingMode": "defineBelow",
          "schema": [
            { "id": "User_ID", "displayName": "User_ID", "required": false, "defaultMatch": true, "canBeUsedToMatch": true, "type": "string" },
            { "id": "Action", "displayName": "Action", "required": false, "defaultMatch": false, "canBeUsedToMatch": false, "type": "string" },
            { "id": "Timestamp", "displayName": "Timestamp", "required": false, "defaultMatch": false, "canBeUsedToMatch": false, "type": "string" }
          ],
          "value": {
            "User_ID": "={{ $('Parse Message').item.json.userId }}",
            "Action": "clear-all",
            "Timestamp": "={{ Date.now() }}"
          },
          "matchingColumns": ["User_ID"]
        },
        "options": { "cellFormat": "USER_ENTERED" }
      },
      "id": "sheets-save-pending-clear-all",
      "name": "Save Pending (clear-all)",
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.5,
      "position": [1100, 800],
      "credentials": { "googleSheetsOAuth2Api": { "id": "n8n-sheet-guard-master", "name": "n8n-sheet-guard-master" } }
    },
    {
      "parameters": {
        "jsCode": "// /clear-all - å›è¦†ç¢ºèªè¨Šæ¯\nconst parsed = $('Parse Message').first().json;\n\nconst message = 'âš ï¸ ç¢ºå®šè¦æ¸…ç©ºæ‰€æœ‰ä½¿ç”¨è€…è³‡æ–™å—ï¼Ÿ\\n\\né€™æ˜¯ä¸å¯é€†çš„æ“ä½œï¼\\n\\nè«‹åœ¨ 5 åˆ†é˜å…§å›è¦† YES ç¢ºèª';\n\nreturn [{ json: { replyToken: parsed.replyToken, message } }];"
      },
      "id": "code-clear-all-ask",
      "name": "Clear All - Ask Confirm",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [1300, 800]
    },
    {
      "parameters": {
        "jsCode": "// æœªçŸ¥æŒ‡ä»¤å›è¦†\nconst parsed = $('Parse Message').first().json;\nconst message = 'â“ æœªçŸ¥æŒ‡ä»¤ï¼š' + parsed.command + '\\n\\nè¼¸å…¥ /help æŸ¥çœ‹å¯ç”¨æŒ‡ä»¤';\n\nreturn [{ json: { replyToken: parsed.replyToken, message } }];"
      },
      "id": "code-unknown",
      "name": "Unknown Command",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [1100, 900]
    },
    {
      "parameters": {
        "jsCode": "// éç®¡ç†è€…å˜—è©¦ä½¿ç”¨æŒ‡ä»¤\nconst parsed = $('Parse Message').first().json;\n\nconst message = 'è«‹ä½¿ç”¨é¸å–®ä¸­çš„ã€Œè¨­å®šã€åŠŸèƒ½ä¾†ç®¡ç†æ‚¨çš„è³‡æ–™ã€‚';\n\nreturn [{ json: { replyToken: parsed.replyToken, message } }];"
      },
      "id": "code-not-authorized",
      "name": "Not Authorized",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [1100, -100]
    },
    {
      "parameters": {
        "method": "POST",
        "url": "https://api.line.me/v2/bot/message/reply",
        "authentication": "genericCredentialType",
        "genericAuthType": "httpHeaderAuth",
        "sendHeaders": true,
        "headerParameters": { "parameters": [{ "name": "Content-Type", "value": "application/json" }] },
        "sendBody": true,
        "specifyBody": "json",
        "jsonBody": "={{ JSON.stringify({ replyToken: $json.replyToken, messages: [{ type: 'text', text: $json.message }] }) }}",
        "options": {}
      },
      "id": "http-line-reply",
      "name": "LINE Reply",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [2950, 500],
      "credentials": { "httpHeaderAuth": { "id": "line-channel-token", "name": "LINE Channel Token" } }
    }
  ],
  "connections": {
    "LINE Webhook": {
      "main": [[{ "node": "Parse Message", "type": "main", "index": 0 }]]
    },
    "Parse Message": {
      "main": [[{ "node": "Should Process?", "type": "main", "index": 0 }]]
    },
    "Should Process?": {
      "main": [
        [{ "node": "Command Router", "type": "main", "index": 0 }],
        []
      ]
    },
    "Command Router": {
      "main": [
        [{ "node": "Not Authorized", "type": "main", "index": 0 }],
        [{ "node": "Get My Status", "type": "main", "index": 0 }],
        [{ "node": "Format Help", "type": "main", "index": 0 }],
        [{ "node": "Save Pending (clear-me)", "type": "main", "index": 0 }],
        [{ "node": "Get Pending Confirmation", "type": "main", "index": 0 }],
        [{ "node": "Check Admin (list-usr)", "type": "main", "index": 0 }],
        [{ "node": "Check Admin (check-usr)", "type": "main", "index": 0 }],
        [{ "node": "Check Admin (del-usr)", "type": "main", "index": 0 }],
        [{ "node": "Save Pending (clear-all)", "type": "main", "index": 0 }],
        [{ "node": "Unknown Command", "type": "main", "index": 0 }]
      ]
    },
    "Not Authorized": {
      "main": [[{ "node": "LINE Reply", "type": "main", "index": 0 }]]
    },
    "Get My Status": {
      "main": [[{ "node": "Format My Status", "type": "main", "index": 0 }]]
    },
    "Format My Status": {
      "main": [[{ "node": "LINE Reply", "type": "main", "index": 0 }]]
    },
    "Format Help": {
      "main": [[{ "node": "LINE Reply", "type": "main", "index": 0 }]]
    },
    "Save Pending (clear-me)": {
      "main": [[{ "node": "Clear Me - Ask Confirm", "type": "main", "index": 0 }]]
    },
    "Clear Me - Ask Confirm": {
      "main": [[{ "node": "LINE Reply", "type": "main", "index": 0 }]]
    },
    "Get Pending Confirmation": {
      "main": [[{ "node": "Check Pending Status", "type": "main", "index": 0 }]]
    },
    "Check Pending Status": {
      "main": [[{ "node": "Route Pending Action", "type": "main", "index": 0 }]]
    },
    "Route Pending Action": {
      "main": [
        [{ "node": "Execute Clear Me", "type": "main", "index": 0 }],
        [{ "node": "Get Sheet Info", "type": "main", "index": 0 }],
        [{ "node": "LINE Reply", "type": "main", "index": 0 }]
      ]
    },
    "Execute Clear Me": {
      "main": [[{ "node": "Delete Pending (clear-me)", "type": "main", "index": 0 }]]
    },
    "Delete Pending (clear-me)": {
      "main": [[{ "node": "Clear Me Done", "type": "main", "index": 0 }]]
    },
    "Clear Me Done": {
      "main": [[{ "node": "LINE Reply", "type": "main", "index": 0 }]]
    },
    "Get Sheet Info": {
      "main": [[{ "node": "Prepare Clear All", "type": "main", "index": 0 }]]
    },
    "Prepare Clear All": {
      "main": [[{ "node": "Should Delete?", "type": "main", "index": 0 }]]
    },
    "Should Delete?": {
      "main": [
        [{ "node": "Delete All Rows", "type": "main", "index": 0 }],
        [{ "node": "LINE Reply", "type": "main", "index": 0 }]
      ]
    },
    "Delete All Rows": {
      "main": [[{ "node": "Delete Pending (clear-all)", "type": "main", "index": 0 }]]
    },
    "Delete Pending (clear-all)": {
      "main": [[{ "node": "Clear All Done", "type": "main", "index": 0 }]]
    },
    "Clear All Done": {
      "main": [[{ "node": "LINE Reply", "type": "main", "index": 0 }]]
    },
    "Check Admin (list-usr)": {
      "main": [[{ "node": "Admin Auth? (list)", "type": "main", "index": 0 }]]
    },
    "Admin Auth? (list)": {
      "main": [
        [{ "node": "Get All Users (list)", "type": "main", "index": 0 }],
        [{ "node": "LINE Reply", "type": "main", "index": 0 }]
      ]
    },
    "Get All Users (list)": {
      "main": [[{ "node": "Format list-usr", "type": "main", "index": 0 }]]
    },
    "Format list-usr": {
      "main": [[{ "node": "LINE Reply", "type": "main", "index": 0 }]]
    },
    "Check Admin (check-usr)": {
      "main": [[{ "node": "Admin Auth? (check)", "type": "main", "index": 0 }]]
    },
    "Admin Auth? (check)": {
      "main": [
        [{ "node": "Get Target User (check)", "type": "main", "index": 0 }],
        [{ "node": "LINE Reply", "type": "main", "index": 0 }]
      ]
    },
    "Get Target User (check)": {
      "main": [[{ "node": "Format check-usr", "type": "main", "index": 0 }]]
    },
    "Format check-usr": {
      "main": [[{ "node": "LINE Reply", "type": "main", "index": 0 }]]
    },
    "Check Admin (del-usr)": {
      "main": [[{ "node": "Admin Auth? (del)", "type": "main", "index": 0 }]]
    },
    "Admin Auth? (del)": {
      "main": [
        [{ "node": "Read All Users (del)", "type": "main", "index": 0 }],
        [{ "node": "LINE Reply", "type": "main", "index": 0 }]
      ]
    },
    "Read All Users (del)": {
      "main": [[{ "node": "Find User Row", "type": "main", "index": 0 }]]
    },
    "Find User Row": {
      "main": [[{ "node": "User Found?", "type": "main", "index": 0 }]]
    },
    "User Found?": {
      "main": [
        [{ "node": "Get Sheet Info (del)", "type": "main", "index": 0 }],
        [{ "node": "LINE Reply", "type": "main", "index": 0 }]
      ]
    },
    "Get Sheet Info (del)": {
      "main": [[{ "node": "Prepare Delete User", "type": "main", "index": 0 }]]
    },
    "Prepare Delete User": {
      "main": [[{ "node": "Delete User Row", "type": "main", "index": 0 }]]
    },
    "Delete User Row": {
      "main": [[{ "node": "Format del-usr (success)", "type": "main", "index": 0 }]]
    },
    "Format del-usr (success)": {
      "main": [[{ "node": "LINE Reply", "type": "main", "index": 0 }]]
    },
    "Save Pending (clear-all)": {
      "main": [[{ "node": "Clear All - Ask Confirm", "type": "main", "index": 0 }]]
    },
    "Clear All - Ask Confirm": {
      "main": [[{ "node": "LINE Reply", "type": "main", "index": 0 }]]
    },
    "Unknown Command": {
      "main": [[{ "node": "LINE Reply", "type": "main", "index": 0 }]]
    }
  },
  "settings": { "executionOrder": "v1" },
  "staticData": null,
  "tags": [],
  "triggerCount": 1,
  "pinData": {}
}
